var AmsifySuggestags;(function(s){"object"===typeof module&&"object"===typeof module.exports?s(require("jquery"),window,document):s(jQuery,window,document)})((function(s,t,e,i){AmsifySuggestags=function(s){this.selector=s,this.settings={type:"bootstrap",tagLimit:-1,tagvLimit:3,suggestions:[],suggestionsAction:{timeout:-1,minChars:2,minChange:-1,type:"GET"},defaultTagClass:"",classes:[],backgrounds:[],colors:[],whiteList:!1,afterAdd:{},afterRemove:{},selectOnHover:!0,triggerChange:!1,noSuggestionMsg:"",showAllSuggestions:!1,keepLastOnHoverTag:!0,printValues:!0,checkSimilar:!0,delimiters:[]},this.method=i,this.name=null,this.defaultLabel="Type here",this.classes={sTagsArea:".amsify-suggestags-area",inputArea:".amsify-suggestags-input-area",inputAreaDef:".amsify-suggestags-input-area-default",focus:".amsify-focus",sTagsInput:".amsify-suggestags-input",listArea:".amsify-suggestags-list",list:".amsify-list",listItem:".amsify-list-item",itemPad:".amsify-item-pad",inputType:".amsify-select-input",tagItem:".amsify-select-tag",colBg:".col-bg",removeTag:".amsify-remove-tag",readyToRemove:".ready-to-remove",noSuggestion:".amsify-no-suggestion"},this.selectors={sTagsArea:null,inputArea:null,inputAreaDef:null,sTagsInput:null,listArea:null,list:null,listGroup:null,listItem:null,itemPad:null,inputType:null},this.isRequired=!1,this.ajaxActive=!1,this.tagNames=[]},AmsifySuggestags.prototype={_settings:function(t){this.settings=s.extend(!0,{},this.settings,t)},_setMethod:function(s){this.method=s},_init:function(){this.checkMethod()&&(this.name=s(this.selector).attr("name")?s(this.selector).attr("name")+"_amsify":"amsify_suggestags",this.createHTML(),this.setEvents(),s(this.selector).hide(),this.setDefault())},createHTML:function(){var t='<div class="'+this.classes.sTagsArea.substring(1)+'"></div>';this.selectors.sTagsArea=s(t).insertAfter(this.selector);var e='<div class="'+this.classes.inputArea.substring(1)+'"></div>';this.selectors.inputArea=s(e).appendTo(this.selectors.sTagsArea),this.defaultLabel=s(this.selector).attr("placeholder")!==i?s(this.selector).attr("placeholder"):this.defaultLabel;var a='<input type="text" class="'+this.classes.sTagsInput.substring(1)+'" placeholder="'+this.defaultLabel+'">';this.selectors.sTagsInput=s(a).appendTo(this.selectors.inputArea).attr("autocomplete","off"),s(this.selector).attr("required")&&(s(this.selector).removeAttr("required"),this.isRequired=!0,this.updateIsRequired());var n='<div class="'+this.classes.listArea.substring(1)+'"></div>';this.selectors.listArea=s(n).appendTo(this.selectors.sTagsArea),s(this.selectors.listArea).width(s(this.selectors.sTagsArea).width()-3);var o='<ul class="'+this.classes.list.substring(1)+'"></ul>';this.selectors.list=s(o).appendTo(this.selectors.listArea),this.updateSuggestionList(),this.fixCSS()},updateIsRequired:function(){this.isRequired&&(this.tagNames.length?s(this.selectors.sTagsInput).removeAttr("required"):s(this.selectors.sTagsInput).attr("required","required"))},updateSuggestionList:function(){s(this.selectors.list).html(""),s(this.createList()).appendTo(this.selectors.list)},setEvents:function(){var e=this;s(this.selectors.inputArea).attr("style",s(this.selector).attr("style")).addClass(s(this.selector).attr("class")),this.setTagEvents(),t!==i&&s(t).resize((function(){s(e.selectors.listArea).width(s(e.selectors.sTagsArea).width()-3)})),this.setSuggestionsEvents(),this.setRemoveEvent()},setTagEvents:function(){var t=this;s(this.selectors.sTagsInput).focus((function(){t.settings.showAllSuggestions&&t.suggestWhiteList("",0,!0),s(this).closest(t.classes.inputArea).addClass(t.classes.focus.substring(1)),"materialize"==t.settings.type&&s(this).css({"border-bottom":"none","-webkit-box-shadow":"none","box-shadow":"none"})})),s(this.selectors.sTagsInput).blur((function(){s(this).closest(t.classes.inputArea).removeClass(t.classes.focus.substring(1)),s(this).val()||s(t.selectors.listArea).hide()})),s(this.selectors.sTagsInput).keyup((function(e){var i=e.keyCode?e.keyCode:e.which,a="";e.key?a=e.key:"13"==i?a="Enter":"188"==i&&(a=",");var n=-1!==s.inArray(a,t.settings.delimiters);if("Enter"==a||","==a||n){var o=s.trim(s(this).val().replace(/,/g,""));n&&s.each(t.settings.delimiters,(function(t,e){o=s.trim(o.replace(e,""))})),s(this).val(""),t.addTag(t.getValue(o)),t.settings.showAllSuggestions&&t.suggestWhiteList("",0,!0)}else if("8"!=i||s(this).val())(t.settings.suggestions.length||t.isSuggestAction())&&(s(this).val()||t.settings.showAllSuggestions)&&(s(this).removeClass(t.classes.readyToRemove.substring(1)),t.processWhiteList(i,s(this).val()));else{var r=t.classes.readyToRemove.substring(1);s(this).hasClass(r)?($item=s(this).closest(t.classes.inputArea).find(t.classes.tagItem+":last"),t.removeTagByItem($item,!1)):s(this).addClass(r),s(t.selectors.listArea).hide(),t.settings.showAllSuggestions&&t.suggestWhiteList("",0,!0)}})),s(this.selectors.sTagsInput).keypress((function(s){var t=s.keyCode?s.keyCode:s.which;if(13==t)return!1})),s(this.selectors.sTagsArea).click((function(){s(t.selectors.sTagsInput).focus()}))},setSuggestionsEvents:function(){var t=this;this.settings.selectOnHover&&s(this.selectors.listArea).find(this.classes.listItem).hover((function(){s(t.selectors.listArea).find(t.classes.listItem).removeClass("active"),s(this).addClass("active"),s(t.selectors.sTagsInput).val(s(this).text())}),(function(){s(this).removeClass("active"),t.settings.keepLastOnHoverTag||s(t.selectors.sTagsInput).val("")})),s(this.selectors.listArea).find(this.classes.listItem).click((function(){t.addTag(s(this).data("val")),s(t.selectors.sTagsInput).val("").focus(),t.updateSuggestionList(),t.setSuggestionsEvents()})),s(".amsify-suggestags-lista").find(this.classes.listItem).click((function(){t.addTag(s(this).data("val")),t.updateSuggestionList(),t.setSuggestionsEvents(),s(t.selectors.sTagsInput).val("").focus()}))},isSuggestAction:function(){return this.settings.suggestionsAction&&this.settings.suggestionsAction.url},getTag:function(t){if(this.settings.suggestions.length){var e=t;return s.each(this.settings.suggestions,(function(s,i){return"object"===typeof i&&i.value==t?(e=i.tag,!1):i!=t&&void 0})),e}return t},getValue:function(t){if($findTags=s(".").find('[data-val="'+e+'"]'),this.settings.suggestions.length){var e=t,i=t.toString().toLowerCase();return s.each(this.settings.suggestions,(function(s,t){return"object"===typeof t&&t.tag.toString().toLowerCase()==i?(e=t.value,!1):t.toString().toLowerCase()!=i&&void 0})),e}return t},processAjaxSuggestion:function(t,e){var a=this,n=this.getActionURL(this.settings.suggestionsAction.url),o={existingTags:this.tagNames,existing:this.settings.suggestions,term:t},r=(this.settings.suggestionsAction.callbacks&&this.settings.suggestionsAction.callbacks,{url:n});"GET"==this.settings.suggestionsAction.type?r.url=r.url+"?"+s.param(o):(r.type=this.settings.suggestionsAction.type,r.data=o),-1!==this.settings.suggestionsAction.timeout&&(r["timeout"]=1e3*this.settings.suggestionsAction.timeout),this.settings.suggestionsAction.beforeSend!==i&&"function"==typeof this.settings.suggestionsAction.beforeSend&&(r["beforeSend"]=this.settings.suggestionsAction.beforeSend),r["success"]=function(n){n&&n.suggestions&&(a.settings.suggestions=s.merge(a.settings.suggestions,n.suggestions),a.settings.suggestions=a.unique(a.settings.suggestions),a.updateSuggestionList(),a.setSuggestionsEvents(),a.suggestWhiteList(t,e)),a.settings.suggestionsAction.success!==i&&"function"==typeof a.settings.suggestionsAction.success&&a.settings.suggestionsAction.success(n)},this.settings.suggestionsAction.error!==i&&"function"==typeof this.settings.suggestionsAction.error&&(r["error"]=this.settings.suggestionsAction.error),r["complete"]=function(s){a.settings.suggestionsAction.complete!==i&&"function"==typeof a.settings.suggestionsAction.complete&&a.settings.suggestionsAction.complete(s),a.ajaxActive=!1},s.ajax(r)},processWhiteList:function(s,t){if("40"==s||"38"==s){var e="40"==s?"down":"up";this.upDownSuggestion(t,e)}else if(this.isSuggestAction()&&!this.ajaxActive){var i=this.settings.suggestionsAction.minChars,a=this.settings.suggestionsAction.minChange,n=this.selectors.sTagsInput.attr("last-search");t.length>=i&&(-1===a||!n||100*this.similarity(n,t)<=a)&&(this.selectors.sTagsInput.attr("last-search",t),this.ajaxActive=!0,this.processAjaxSuggestion(t,s))}else this.suggestWhiteList(t,s)},upDownSuggestion:function(t,e){var i=this,a=!1;if(s(this.selectors.listArea).find(this.classes.listItem+":visible").each((function(){if(s(this).hasClass("active"))return s(this).removeClass("active"),$item="up"==e?s(this).prevAll(i.classes.listItem+":visible:first"):s(this).nextAll(i.classes.listItem+":visible:first"),$item.length&&(a=!0,$item.addClass("active"),s(i.selectors.sTagsInput).val($item.text())),!1})),!a){var n="down"==e?"first":"last";$item=s(this.selectors.listArea).find(this.classes.listItem+":visible:"+n),$item.length&&($item.addClass("active"),s(i.selectors.sTagsInput).val($item.text()))}},suggestWhiteList:function(t,e,i){var a=this,n=!1,o=!!i,r=t.toString().toLowerCase();s(this.selectors.listArea).find(a.classes.noSuggestion).hide();var g=s(this.selectors.listArea).find(this.classes.list);g.find(this.classes.listItem).each((function(){var e=s(this).data("val");s.isNumeric(e)&&(e=-1==t.toString().indexOf(".")?parseInt(e):parseFloat(e)),(o||~s(this).text().toString().toLowerCase().indexOf(r))&&-1===s.inArray(e,a.tagNames)?(s(this).attr("data-show",1),n=!0):s(this).removeAttr("data-show"),s(this).hide()})),n?($dataShow=g.find(this.classes.listItem+"[data-show]"),r?$dataShow.sort((function(e,i){return t.localeCompare(s(e).text().toString())})).appendTo(g):$dataShow.sort((function(t,e){return s(t).text().toString().localeCompare(s(e).text().toString())})).appendTo(g),$dataShow.each((function(){s(this).show()})),$item=s(this.selectors.listArea).find(this.classes.listItem+":visible"),1==$item.length&&"8"!=e?(this.settings.whiteList&&this.isSimilarText(t.toLowerCase(),$item.text().toLowerCase(),40)||this.isSimilarText(t.toLowerCase(),$item.text().toLowerCase(),60))&&($item.addClass("active"),s(this.selectors.sTagsInput).val($item.text())):$item.removeClass("active"),s(this.selectors.listArea).show()):t&&a.settings.noSuggestionMsg?(s(this.selectors.listArea).find(a.classes.listItem).hide(),s(this.selectors.listArea).find(a.classes.noSuggestion).show()):s(this.selectors.listArea).hide()},setDefault:function(){var t=this,e=s(this.selector).val().split(",");e.length&&s.each(e,(function(e,i){t.addTag(s.trim(i))}))},setRemoveEvent:function(){var t=this;s(this.selectors.inputArea).find(this.classes.removeTag).click((function(e){e.stopImmediatePropagation(),$tagItem=s(this).closest(t.classes.tagItem),t.removeTagByItem($tagItem,!1),t.updateSuggestionList(),t.setSuggestionsEvents()}))},createList:function(){for(var t=s(this.selector).val().split(","),e=(t=s(this.selector).val().split(","),this.settings.suggestions),i=(s(this.selector).val(),new Array),a=0;a<e.length;a++){var n=e[a],o=t.indexOf(n);"-1"==o&&(n,i.push(n))}var r=this,g="",l="",c=this.settings.tagvLimit;return s.each(i,(function(s,t){var e="",i="";"object"===typeof t?(e=t.value,i=t.tag):(e=t,i=t),s>=c?(g+='<li class="'+r.classes.listItem.substring(1)+'" data-val="'+e+'" style="display: none;">'+i+"</li>",l+='<a href="javascript:void(0);" class="'+r.classes.listItem.substring(1)+'" data-val="'+e+'" style="display: none;">'+i+"</a>"):(g+='<li class="'+r.classes.listItem.substring(1)+'" data-val="'+e+'">'+i+"</li>",l+='<span class="coma-sep">,</span> <a href="javascript:void(0);" class="'+r.classes.listItem.substring(1)+'" data-val="'+e+'">'+i+"</a>")})),r.settings.noSuggestionMsg&&(g+='<li class="'+r.classes.noSuggestion.substring(1)+'">'+r.settings.noSuggestionMsg+"</li>",l+='<a href="javascript:void(0);" class="'+r.classes.noSuggestion.substring(1)+'">'+r.settings.noSuggestionMsg+"</a>"),s(".vlist").html(l.substring(32)),g},addTag:function(t){if(t){var e='<span class="'+this.classes.tagItem.substring(1)+'" data-val="'+t+'">'+this.getTag(t)+" "+this.setIcon()+"</span>";if($item=s(e).insertBefore(s(this.selectors.sTagsInput)),this.settings.defaultTagClass&&$item.addClass(this.settings.defaultTagClass),-1!=this.settings.tagLimit&&this.settings.tagLimit>0&&this.tagNames.length>=this.settings.tagLimit)return this.animateRemove($item,!0),this.flashItem(t),!1;var i=this.getItemKey(t);if(this.settings.whiteList&&-1===i)return this.animateRemove($item,!0),this.flashItem(t),!1;if(this.isPresent(t))this.animateRemove($item,!0),this.flashItem(t);else{this.customStylings($item,i);var a=t;s.isNumeric(a)&&(a=-1==t.toString().indexOf(".")?parseInt(a):parseFloat(a)),this.tagNames.push(a),this.setRemoveEvent(),this.setInputValue(),this.settings.afterAdd&&"function"==typeof this.settings.afterAdd&&this.settings.afterAdd(t)}s(this.selector).trigger("suggestags.add",[t]),s(this.selector).trigger("suggestags.change"),this.settings.triggerChange&&s(this.selector).trigger("change"),s(this.selectors.listArea).find(this.classes.listItem).removeClass("active"),s(this.selectors.listArea).hide(),s(this.selectors.sTagsInput).removeClass(this.classes.readyToRemove.substring(1))}},getItemKey:function(t){var e=-1;if(this.settings.suggestions.length){var i=t.toString().toLowerCase();s.each(this.settings.suggestions,(function(s,t){if("object"===typeof t){if(t.value.toString().toLowerCase()==i)return e=s,!1}else if(t.toString().toLowerCase()==i)return e=s,!1}))}return e},isPresent:function(t){var e=!1;return s.each(this.tagNames,(function(s,i){if(t.toString().toLowerCase()==i.toString().toLowerCase())return e=!0,!1})),e},customStylings:function(t,e){var i=!1;this.settings.classes[e]&&(i=!0,s(t).addClass(this.settings.classes[e])),this.settings.backgrounds[e]&&(i=!0,s(t).css("background",this.settings.backgrounds[e])),this.settings.colors[e]&&(i=!0,s(t).css("color",this.settings.colors[e])),i||s(t).addClass(this.classes.colBg.substring(1))},removeTag:function(t){var e=this;$findTags=s(this.selectors.sTagsArea).find('[data-val="'+t+'"]'),$findTags.length&&$findTags.each((function(){e.removeTagByItem(this,!0)}))},removeTagByItem:function(t,e){this.tagNames.splice(s(t).index(),1),this.animateRemove(t,e),this.setInputValue(),s(this.selector).trigger("suggestags.remove",[s(t).attr("data-val")]),s(this.selector).trigger("suggestags.change"),this.settings.triggerChange&&s(this.selector).trigger("change"),this.settings.afterRemove&&"function"==typeof this.settings.afterRemove&&this.settings.afterRemove(s(t).attr("data-val")),s(this.selectors.sTagsInput).removeClass(this.classes.readyToRemove.substring(1))},animateRemove:function(t,e){s(t).addClass("disabled"),e?setTimeout((function(){s(t).slideUp(),setTimeout((function(){s(t).remove()}),500)}),500):s(t).remove()},flashItem:function(t){$item="",t=t.toString().toLowerCase(),s(this.selectors.sTagsArea).find(this.classes.tagItem).each((function(){var e=s.trim(s(this).attr("data-val"));if(t==e.toString().toLowerCase())return $item=s(this),!1})),$item&&($item.addClass("flash"),setTimeout((function(){$item.removeClass("flash")}),1500))},setIcon:function(){var s=this.classes.removeTag.substring(1);return"bootstrap"==this.settings.type?'<span class="skills-close '+s+'">&times;</span>':"materialize"==this.settings.type?'<i class="material-icons right '+s+'">clear</i>':'<b class="'+s+'">&#10006;</b>'},setInputValue:function(){this.updateIsRequired(),s(this.selector).val(this.tagNames.join(",")),this.settings.printValues&&this.printValues()},fixCSS:function(){"amsify"==this.settings.type?s(this.selectors.inputArea).addClass(this.classes.inputAreaDef.substring(1)).css({padding:"5px 5px"}):"materialize"==this.settings.type&&(s(this.selectors.inputArea).addClass(this.classes.inputAreaDef.substring(1)).css({height:"auto",padding:"5px 5px"}),s(this.selectors.sTagsInput).css({margin:"0",height:"auto"}))},printValues:function(){console.info(this.tagNames,s(this.selector).val())},checkMethod:function(){return $findTags=s(this.selector).next(this.classes.sTagsArea),$findTags.length&&$findTags.remove(),s(this.selector).show(),typeof this.method===i||"destroy"!=this.method},refresh:function(){this._setMethod("refresh"),this._init()},destroy:function(){this._setMethod("destroy"),this._init()},getActionURL:function(s){var e="";return t!==i&&(e=t.location.protocol+"//"+t.location.host),this.isAbsoluteURL(s)?e=s:e+="/"+s.replace(/^\/|\/$/g,""),e},isAbsoluteURL:function(s){var t=new RegExp("^(?:[a-z]+:)?//","i");return!!t.test(s)},unique:function(t){var e=[],i=this;return s.each(t,(function(t,a){"object"===typeof a?i.objectInArray(a,e)||e.push(a):-1==s.inArray(a,e)&&e.push(a)})),e},objectInArray:function(t,e){if(e.length){var i=!1;return s.each(e,(function(s,e){if("object"===typeof e){if(e.value==t.value)return i=!0,!1}else if(e==t.value)return i=!0,!1})),i}return!1},isSimilarText:function(s,t,e){if(!this.settings.checkSimilar)return!1;var i=this.similarity(s,t);return 100*i>=e},similarity:function(s,t){var e=s,i=t;s.length<t.length&&(e=t,i=s);var a=e.length;return 0==a?1:(a-this.editDistance(e,i))/parseFloat(a)},editDistance:function(s,t){s=s.toLowerCase(),t=t.toLowerCase();for(var e=new Array,i=0;i<=s.length;i++){for(var a=i,n=0;n<=t.length;n++)if(0==i)e[n]=n;else if(n>0){var o=e[n-1];s.charAt(i-1)!=t.charAt(n-1)&&(o=Math.min(Math.min(o,a),e[n])+1),e[n-1]=a,a=o}i>0&&(e[t.length]=a)}return e[t.length]}},s.fn.amsifySuggestags=function(s,t){return this.each((function(){var e=new AmsifySuggestags(this);e._settings(s),e._setMethod(t),e._init()}))}}));